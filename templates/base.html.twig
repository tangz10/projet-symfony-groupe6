<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>"
        >
        {% block stylesheets %}{% endblock %}
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

        {% block javascripts %}
            {% block importmap %}{{ importmap('app') }}{% endblock %}
        {% endblock %}
    </head>

    <body class="min-h-dvh overflow-auto md:overflow-hidden flex flex-col bg-gray-100">
    {% set current_route = app.request.attributes.get('_route') %}

    {% if current_route not in ['app_login', 'app_register'] %}
        <div class="bg-gray-100 font-sans w-full m-0">
            <div class="bg-white shadow">
                <div class="container mx-auto px-4">
                    <div class="flex items-center justify-between py-4">
                        <div>
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-purple-600" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M14.5,16 C14.2238576,16 14,15.7761424 14,15.5 L14,9.5 C14,9.22385763 14.2238576,9 14.5,9 L16,9 C17.1045695,9 18,9.8954305 18,11 C18,11.4116588 17.8756286,11.7942691 17.6624114,12.1123052 C18.4414283,12.3856578 19,13.1275982 19,14 C19,15.1045695 18.1045695,16 17,16 L14.5,16 Z M15,15 L17,15 C17.5522847,15 18,14.5522847 18,14 C18,13.4477153 17.5522847,13 17,13 L15,13 L15,15 Z M15,12 L16,12 C16.5522847,12 17,11.5522847 17,11 C17,10.4477153 16.5522847,10 16,10 L15,10 L15,12 Z M12.9499909,4 L19.5,4 C20.8807119,4 22,5.11928813 22,6.5 L22,19.5 C22,20.8807119 20.8807119,22 19.5,22 L13.5,22 C12.2700325,22 11.2475211,21.1117749 11.0389093,19.9417682 C10.8653433,19.9799013 10.6850188,20 10.5,20 L4.5,20 C3.11928813,20 2,18.8807119 2,17.5 L2,4.5 C2,3.11928813 3.11928813,2 4.5,2 L10.5,2 C11.709479,2 12.7183558,2.85887984 12.9499909,4 Z M13,5 L13,17.5 C13,18.3179089 12.6072234,19.0440799 12,19.5001831 C12.0000989,20.3285261 12.6716339,21 13.5,21 L19.5,21 C20.3284271,21 21,20.3284271 21,19.5 L21,6.5 C21,5.67157288 20.3284271,5 19.5,5 L13,5 Z M8.56005566,11.4964303 C8.54036595,11.4987873 8.52032459,11.5 8.5,11.5 L6.5,11.5 C6.47967541,11.5 6.45963405,11.4987873 6.43994434,11.4964303 L5.96423835,12.6856953 C5.86168164,12.9420871 5.57069642,13.066795 5.31430466,12.9642383 C5.0579129,12.8616816 4.93320495,12.5706964 5.03576165,12.3143047 L7.03576165,7.31430466 C7.20339081,6.89523178 7.79660919,6.89523178 7.96423835,7.31430466 L9.96423835,12.3143047 C10.066795,12.5706964 9.9420871,12.8616816 9.68569534,12.9642383 C9.42930358,13.066795 9.13831836,12.9420871 9.03576165,12.6856953 L8.56005566,11.4964303 Z M8.16148352,10.5 L7.5,8.8462912 L6.83851648,10.5 L8.16148352,10.5 Z M10.5,3 L4.5,3 C3.67157288,3 3,3.67157288 3,4.5 L3,17.5 C3,18.3284271 3.67157288,19 4.5,19 L10.5,19 C11.3284271,19 12,18.3284271 12,17.5 L12,4.5 C12,3.67157288 11.3284271,3 10.5,3 Z M6.5,18 C6.22385763,18 6,17.7761424 6,17.5 C6,17.2238576 6.22385763,17 6.5,17 L8.5,17 C8.77614237,17 9,17.2238576 9,17.5 C9,17.7761424 8.77614237,18 8.5,18 L6.5,18 Z M15.5,20 C15.2238576,20 15,19.7761424 15,19.5 C15,19.2238576 15.2238576,19 15.5,19 L17.5,19 C17.7761424,19 18,19.2238576 18,19.5 C18,19.7761424 17.7761424,20 17.5,20 L15.5,20 Z"/>
                            </svg>
                        </div>

                        <div class="hidden sm:flex sm:items-center">
                            {% if is_granted('ROLE_ADMIN') %}
                                <a href="{{ path('app_sortie_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4">Sorties</a>
                                <a href="{{ path('app_ville_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4">Villes</a>
                                <a href="{{ path('app_site_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4">Sites</a>
                                <a href="{{ path('app_participant_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600">Administration</a>
                            {% else %}
                                <a href="{{ path('app_sortie_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4">Sorties</a>
                            {% endif %}
                        </div>

                        <div class="hidden sm:flex sm:items-center gap-4">
                            {% if app.user %}
                                <a href="{{ path('app_logout') }}" class="text-red-800 text-sm font-semibold border border-red-600 px-4 py-2 rounded-lg hover:text-red-600">Deconnexion</a>
                                <a href="{{ path('app_participant_show', {'id': app.user.id}) }}"
                                   class="inline-flex items-center justify-center w-10 h-10 rounded-full border-2 border-purple-600 bg-purple-100 hover:bg-purple-200 transition">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                         xmlns="http://www.w3.org/2000/svg" class="stroke-purple-600">
                                        <path d="M5 21C5 17.134 8.13401 14 12 14C15.866 14 19 17.134 19 21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z"
                                              stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </a>
                            {% else %}
                                <a href="{{ path('app_login') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4">Connexion</a>
                                <a href="{{ path('app_register') }}" class="text-gray-800 text-sm font-semibold border px-4 py-2 rounded-lg hover:text-purple-600 hover:border-purple-600">S'enregistrer</a>
                            {% endif %}
                        </div>

                        <div class="sm:hidden cursor-pointer">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-purple-600" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M12.9499909,17 ... Z"/>
                            </svg>
                        </div>
                    </div>

                    <div class="block sm:hidden bg-white border-t-2 py-2">
                        <div class="flex flex-col">
                            {% if is_granted('ROLE_ADMIN') %}
                                <a href="{{ path('app_sortie_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mb-1">Sorties</a>
                                <a href="{{ path('app_ville_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mb-1">Ville</a>
                                <a href="{{ path('app_site_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mb-1">Site</a>
                                <a href="{{ path('app_participant_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mb-1">Administration</a>
                            {% else %}
                                <a href="{{ path('app_sortie_index') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mb-1">Sorties</a>
                            {% endif %}
                            <div class="flex justify-between items-center border-t-2 pt-2">
                                {% if app.user %}
                                    <a href="{{ path('app_logout') }}" class="text-red-800 text-sm font-semibold border px-4 py-1 rounded-lg hover:text-red-600 hover:border-red-600">Deconnexion</a>
                                {% else %}
                                    <a href="{{ path('app_login') }}" class="text-gray-800 text-sm font-semibold hover:text-purple-600 mr-4">Connexion</a>
                                    <a href="{{ path('app_register') }}" class="text-gray-800 text-sm font-semibold border px-4 py-1 rounded-lg hover:text-purple-600 hover:border-purple-600">Inscription</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    {% endif %}

    {# Section des messages flash #}
    <div class="container mx-auto px-4 mt-4">
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="flash-message mb-4 rounded-xl p-4 animate-fade-in {% if label == 'success' %}bg-green-50 border border-green-200{% elseif label == 'error' %}bg-red-50 border border-red-200{% elseif label == 'warning' %}bg-yellow-50 border border-yellow-200{% else %}bg-blue-50 border border-blue-200{% endif %}">
                    <div class="flex items-start gap-3">
                        <div class="mt-0.5">
                            {% if label == 'success' %}
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                            {% elseif label == 'error' %}
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-600" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                </svg>
                            {% elseif label == 'warning' %}
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                            {% else %}
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                </svg>
                            {% endif %}
                        </div>
                        <div class="text-sm flex-1">
                            <p class="font-semibold {% if label == 'success' %}text-green-800{% elseif label == 'error' %}text-red-800{% elseif label == 'warning' %}text-yellow-800{% else %}text-blue-800{% endif %}">
                                {% if label == 'success' %}
                                    Succès
                                {% elseif label == 'error' %}
                                    Erreur
                                {% elseif label == 'warning' %}
                                    Attention
                                {% else %}
                                    Information
                                {% endif %}
                            </p>
                            <p class="mt-1 {% if label == 'success' %}text-green-700{% elseif label == 'error' %}text-red-700{% elseif label == 'warning' %}text-yellow-700{% else %}text-blue-700{% endif %}">
                                {{ message }}
                            </p>
                        </div>
                        <button onclick="this.closest('.flash-message').remove()" class="ml-2 {% if label == 'success' %}text-green-600 hover:text-green-800{% elseif label == 'error' %}text-red-600 hover:text-red-800{% elseif label == 'warning' %}text-yellow-600 hover:text-yellow-800{% else %}text-blue-600 hover:text-blue-800{% endif %}">
                            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                </div>
            {% endfor %}
        {% endfor %}
    </div>

    <script>
        // Auto-fermeture des messages flash après 5 secondes
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function(message) {
                setTimeout(function() {
                    message.style.opacity = '0';
                    message.style.transform = 'translateY(-20px)';
                    message.style.transition = 'all 0.3s ease-out';
                    setTimeout(function() {
                        message.remove();
                    }, 300);
                }, 5000);
            });
        });
    </script>

    <style>
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
    </style>

    <main class="flex-1 overflow-auto md:overflow-hidden">
        {% block body %}{% endblock %}
    </main>
</html>
